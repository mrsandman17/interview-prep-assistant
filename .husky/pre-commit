#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Secret scanning with gitleaks
echo "ğŸ” Scanning for secrets with gitleaks..."

if ! command -v gitleaks &> /dev/null; then
  echo "âŒ ERROR: gitleaks not found in PATH"
  echo "ğŸ“¦ Install: brew install gitleaks"
  echo "ğŸ”— Or download: https://github.com/gitleaks/gitleaks/releases"
  exit 1
fi

# Scan only staged files (fast)
if ! gitleaks protect --staged --verbose --redact; then
  echo ""
  echo "âŒ SECRET DETECTED! Commit blocked."
  echo ""
  echo "ğŸ› ï¸  To fix:"
  echo "   1. Remove the secret from your code"
  echo "   2. Add to .gitignore if it's a file (e.g., .env.local)"
  echo "   3. If false positive, update .gitleaks.toml allowlist"
  echo ""
  echo "âš ï¸  NEVER commit secrets. Use environment variables or config files."
  echo ""
  exit 1
fi

echo "âœ… No secrets detected. Proceeding with commit."
